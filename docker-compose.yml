version: "3.8"

services:
  backend:
    build: ./backend
    image: sakina593/chatbot:backend
    platform: linux/amd64
    ports:
      - "5000:5000"
    volumes:
      - ./backend/uploads:/app/uploads  # ← ADD THIS! Profile pictures storage!
    environment:
      # --- DATABASE (Loads from .env) ---
      - DATABASE_URL=${DATABASE_URL}
      - DB_NAME=${DB_NAME}
      
      # --- AI KEYS (Loads from .env) ---
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - PINECONE_API_KEY=${PINECONE_API_KEY}
      - PINECONE_INDEX_NAME=${PINECONE_INDEX_NAME}
      - PINECONE_CLOUD=${PINECONE_CLOUD}
      - PINECONE_ENV=${PINECONE_ENV}
      - PINECONE_NAMESPACE=${PINECONE_NAMESPACE}
      - PINECONE_HOST=${PINECONE_HOST}
      
      # --- SECURITY & URLS (Loads from .env) ---
      - JWT_SECRET=${JWT_SECRET}
      - ALGORITHM=${ALGORITHM}
      - ACCESS_TOKEN_EXPIRE_MINUTES=${ACCESS_TOKEN_EXPIRE_MINUTES}
      - VITE_API_BASE_URL=${VITE_API_BASE_URL}
      - VITE_API_URL=${VITE_API_URL}
    restart: unless-stopped

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      args:
        # Passes the URL from your .env to the frontend build
        VITE_API_BASE_URL: ${VITE_API_BASE_URL}
    image: sakina593/chatbot:frontend  # ← ADD THIS for tagging!
    platform: linux/amd64
    ports:
      - "3000:80"
    depends_on:
      - backend
    restart: unless-stopped
